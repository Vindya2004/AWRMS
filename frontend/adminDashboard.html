
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hela Suwaya Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            display: flex;
            flex-wrap: wrap;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            height: 100vh;
            background: #343a40;
            color: white;
            padding: 20px;
            position: fixed;
        }
        .sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px;
            cursor: pointer;
        }
        .sidebar a:hover {
            background: #495057;
        }
        .content {
            flex-grow: 1;
            padding: 20px;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
<div class="sidebar d-flex flex-column p-3">
    <h2 class="text-center">Hela Suwaya Admin</h2>
    <a onclick="showPanel('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a onclick="showPanel('users')"><i class="fas fa-users"></i> Users</a>
    <a onclick="showPanel('activities')"><i class="fas fa-heartbeat"></i> Wellness Program</a>
    <a onclick="showPanel('accommodations')"><i class="fas fa-bed"></i> Accommodation</a>
    <a onclick="showPanel('doctors')"><i class="fas fa-user-md"></i> Doctor</a>
    <a onclick="showPanel('bookings')"><i class="fas fa-calendar-check"></i> Bookings</a>
    <a onclick="showPanel('packages')"><i class="fas fa-gift"></i> Packages</a>
    <a onclick="showPanel('payments')"><i class="fas fa-credit-card"></i> Payments</a>
    <a onclick="showPanel('reviews')"><i class="fas fa-star"></i> Reviews</a>
    <a onclick="showPanel('articles')"><i class="fas fa-newspaper"></i> Articles</a>
    <!-- <a onclick="showPanel('settings')"><i class="fas fa-cog"></i> Settings</a>-->

    <div class="mt-auto text-left">
        <h3>Hi, <span class="font-weight-bold">admin</span></h3>
        <button id="logoutBtn" class="btn btn-danger btn-block dropdown-item text-danger" onclick="logout()">Log Out</button>
    </div>

</div>
<div class="content">

    <div class="container mt-5" id="dashboard">
        <h2 class="mb-4">Welcome to Hela Suwaya Dashboard</h2>
        <div class="row g-4">

            <!-- Total Bookings -->
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-light h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="bi bi-calendar-check fs-1 text-primary me-3"></i>
                        <div>
                            <h6 class="card-subtitle mb-2 text-muted">Total Bookings</h6>
                            <h4 class="card-title mb-0" id="totalBookings">0</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Accommodation -->
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-light h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="bi bi-truck-front fs-1 text-info me-3"></i>
                        <div>
                            <h6 class="card-subtitle mb-2 text-muted">Total Accommodation</h6>
                            <h4 class="card-title mb-0" id="totalVehicles">0</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Doctor -->
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-light h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="bi bi-person-vcard fs-1 text-secondary me-3"></i>
                        <div>
                            <h6 class="card-subtitle mb-2 text-muted">Total Doctor</h6>
                            <h4 class="card-title mb-0" id="totalGuides">0</h4>
                        </div>
                    </div>
                </div>
            </div>


            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

            <div class="container mt-5">
                <div class="row">
                    <!-- Bookings Per Day -->
                    <div class="col-md-6">
                        <div class="card shadow p-3 mb-5 bg-white rounded">
                            <h5 class="text-center">Bookings Per Day</h5>
                            <canvas id="bookingsPerDayChart" height="450"></canvas>
                        </div>
                    </div>

                    <!-- Total Price Per Booking -->
                    <div class="col-md-6">
                        <div class="card shadow p-3 mb-5 bg-white rounded">
                            <h5 class="text-center">Total Price Per Booking</h5>
                            <canvas id="totalPricePerBookingChart" height="450"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                $(document).ready(function () {
                    // Load dashboard counts and charts when the page is ready
                    loadDashboardCounts();
                    loadBookingsPerDayChart();
                    loadTotalPricePerBookingChart();
                });

                // Function to load total counts for bookings, accommodations, and doctors
                function loadDashboardCounts() {
                    $.ajax({
                        url: "http://localhost:8080/api/v1/dashboard/counts",
                        method: "GET",
                        success: function (response) {
                            $('#totalBookings').text(response.data.totalBookings || 0);
                            $('#totalVehicles').text(response.data.totalAccommodations || 0); // Adjusted to match backend
                            $('#totalGuides').text(response.data.totalDoctors || 0); // Adjusted to match backend
                        },
                        error: function () {
                            alert("Failed to load dashboard data.");
                        }
                    });
                }

                // Function to load Bookings Per Day chart
                function loadBookingsPerDayChart() {
                    $.ajax({
                        url: "http://localhost:8080/api/v1/dashboard/chart/booking-per-day",
                        method: "GET",
                        success: function (res) {
                            if (res.data && res.data.length > 0) {
                                const labels = res.data.map(item => item.date);
                                const data = res.data.map(item => item.count || 0);

                                new Chart(document.getElementById('bookingsPerDayChart'), {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Bookings Per Day',
                                            data: data,
                                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                            borderColor: 'rgba(54, 162, 235, 1)',
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                title: { display: true, text: 'Number of Bookings' }
                                            },
                                            x: {
                                                title: { display: true, text: 'Date' }
                                            }
                                        },
                                        plugins: {
                                            legend: { display: true, position: 'top' },
                                            tooltip: { enabled: true }
                                        }
                                    }
                                });
                            } else {
                                alert("No booking data available to display.");
                            }
                        },
                        error: function (xhr) {
                            console.error("Error loading Bookings Per Day chart:", xhr.responseText);
                            alert("Failed to load Bookings Per Day chart data.");
                        }
                    });
                }

                // Function to load Total Price Per Booking chart
                function loadTotalPricePerBookingChart() {
                    $.ajax({
                        url: "http://localhost:8080/api/v1/dashboard/chart/total-price-per-booking",
                        method: "GET",
                        success: function (res) {
                            if (res.data && res.data.length > 0) {
                                const labels = res.data.map(item => "Booking " + item.bookingId);
                                const data = res.data.map(item => item.total || 0);

                                new Chart(document.getElementById('totalPricePerBookingChart'), {
                                    type: 'line',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Total Price Per Booking',
                                            data: data,
                                            fill: false,
                                            borderColor: 'rgba(255, 99, 132, 0.8)',
                                            tension: 0.1
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                title: { display: true, text: 'Price (LKR)' }
                                            },
                                            x: {
                                                title: { display: true, text: 'Booking ID' }
                                            }
                                        },
                                        plugins: {
                                            legend: { display: true, position: 'top' },
                                            tooltip: { enabled: true }
                                        }
                                    }
                                });
                            } else {
                                alert("No price data available to display.");
                            }
                        },
                        error: function (xhr) {
                            console.error("Error loading Total Price Per Booking chart:", xhr.responseText);
                            alert("Failed to load Total Price Per Booking chart data.");
                        }
                    });
                }
            </script>
        </div>
    </div>


    <div id="users" class="hidden">
        <h1>User Management</h1>
        <!-- Search Bar -->
        <div class="d-flex justify-content-end mb-3">
            <input type="text" id="searchInput" class="form-control w-50" placeholder="Search by Name or Email" onkeyup="searchUsers()">
        </div>
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="userTableBody"></tbody>
        </table>
        <script>
            // Load all users when page is ready
            $(document).ready(function () {
                loadAllUsers();
            });

            // Function to load users via AJAX
            function loadAllUsers() {
                $.ajax({
                    url: "http://localhost:8080/api/v1/user/getAll",
                    method: "GET",
                    success: function (users) {
                        $("#userTableBody").empty();
                        window.allUsers = users.data;  // Store all users in a global variable for search
                        renderTable(users.data);  // Render the table initially with all users
                    },
                    error: function (xhr) {
                        console.error("Error fetching users:", xhr.responseText);
                        alert("Failed to load users.");
                    }
                });
            }

            // Function to render the user table
            function renderTable(users) {
                $("#userTableBody").empty(); // Clear the table body
                users.forEach(user => {
                    $("#userTableBody").append(`
            <tr>
                <td>${user.name}</td>
                <td>${user.email}</td>
                <td>${user.role}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.email}')">Delete</button>
                </td>
            </tr>
        `);
                });
            }

            // Function to filter users based on the search input
            function searchUsers() {
                const searchTerm = $("#searchInput").val().toLowerCase();  // Get the search input value
                const filteredUsers = window.allUsers.filter(user => {
                    return user.name.toLowerCase().includes(searchTerm) || user.email.toLowerCase().includes(searchTerm);
                });
                renderTable(filteredUsers);  // Re-render the table with the filtered users
            }

            // Function to delete user
            function deleteUser(email) {
                console.log("Attempting to delete user with email:", email); // Debug log
                if (confirm("Are you sure you want to delete this user?")) {
                    $.ajax({
                        url: `http://localhost:8080/api/v1/user/delete/${email}`,
                        method: "DELETE",
                        success: function (response) {
                            console.log("Delete response:", response);  // Debug log
                            alert("User deleted successfully.");
                            loadAllUsers();  // Reload the users after deletion
                        },
                        error: function (xhr, status, error) {
                            console.error("Error deleting user:", xhr.responseText);  // Debug log
                            alert("Failed to delete user.");
                        }
                    });
                }
            }


        </script>
    </div>

    <!-- Review Management Section -->
    <div id="reviews" class="hidden">
        <h1>Review Management</h1>
        <div class="d-flex justify-content-end mb-3">
            <input type="text" id="searchReview" class="form-control w-25" placeholder="Search by User Email or Comment">
        </div>
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>User Email</th>
                <th>Rating</th>
                <th>Comment</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="reviewTableBody">
            <tr><td colspan="6" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        $(document).ready(function () {
            // Load all reviews when the page is ready
            loadAllReviews();

            // Search functionality for reviews
            $("#searchReview").on("keyup", function () {
                const searchTerm = $(this).val().toLowerCase();
                filterReviews(searchTerm);
            });
        });

        // Function to load all reviews
        function loadAllReviews() {
            $.ajax({
                url: "http://localhost:8080/api/v1/review/all",
                method: "GET",
                success: function (response) {
                    if (response.code === 201 || response.code === 200) {
                        window.allReviews = response.data; // Store reviews globally for filtering
                        renderReviews(response.data);
                    } else {
                        $("#reviewTableBody").html(`<tr><td colspan="6" class="text-center">No reviews found</td></tr>`);
                    }
                },
                error: function (xhr) {
                    console.error("Error loading reviews:", xhr.responseText);
                    $("#reviewTableBody").html(`<tr><td colspan="6" class="text-center text-danger">Failed to load reviews</td></tr>`);
                }
            });
        }

        // Function to render reviews in the table
        function renderReviews(reviews) {
            const tbody = $("#reviewTableBody");
            tbody.empty();

            reviews.forEach(review => {
                const row = `
            <tr>
                <td>${review.id || 'N/A'}</td>
                <td>${review.userEmail || 'N/A'}</td>
                <td>${review.rating || 'N/A'}</td>
                <td>${review.comment || 'N/A'}</td>
                <td>${review.createdAt || 'N/A'}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteReview(${review.id || 0})">Delete</button>
                </td>
            </tr>
        `;
                tbody.append(row);
            });
        }

        // Function to filter reviews based on search input
        function filterReviews(searchTerm) {
            const filteredReviews = window.allReviews.filter(review => {
                return (review.userEmail && review.userEmail.toLowerCase().includes(searchTerm)) ||
                    (review.comment && review.comment.toLowerCase().includes(searchTerm));
            });
            renderReviews(filteredReviews);
        }

        // Function to delete a review
        function deleteReview(id) {
            if (confirm("Are you sure you want to delete this review?")) {
                $.ajax({
                    url: `http://localhost:8080/api/v1/review/delete/${id}`,
                    method: "DELETE",
                    success: function (response) {
                        if (response.code === 200 || response.code === 201 || response.code === 1) {
                            alert("Review deleted successfully.");
                            loadAllReviews(); // Re-fetch all reviews to update the table
                        } else {
                            alert("Failed to delete review: " + (response.message || "Unknown error"));
                        }
                    },
                    error: function (xhr) {
                        console.error("Error deleting review:", xhr.responseText);
                        alert("Failed to delete review.");
                    }
                });
            }
        }
    </script>



    <div id="bookings" class="hidden">
        <h1>Booking Management</h1>
        <div class="d-flex justify-content-end mb-3">
            <input type="text" id="searchBooking" class="form-control w-25" placeholder="Search by Email, Package...">
        </div>
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>Package Name</th>
                <th>Doctor Email</th>
                <th>Accommodation</th>
                <th>User Email</th>
                <th>Booking Date</th>
                <th>Checkout Date</th>
                <th>Estimated Days</th>
                <th>Doctor Fee</th>
                <th>Package Price</th>
                <th>Total Price</th>
            </tr>
            </thead>
            <tbody id="bookingTableBody">
            <tr><td colspan="10" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            const BASE_URL = "http://localhost:8080/api/v1/booking";

            // Load All Bookings
            function loadBookings() {
                $.ajax({
                    url: `${BASE_URL}/getAll`,
                    method: "GET",
                    success: function (response) {
                        if (response.code === 201 || response.code === 200) {
                            let bookings = response.data;
                            let rows = "";

                            bookings.forEach(b => {
                                rows += `
                            <tr>
                                <td>${b.packageName}</td>
                                <td>${b.doctorEmail}</td>
                                <td>${b.accommodationName}</td>
                                <td>${b.userEmail}</td>
                                <td>${b.bookingDate}</td>
                                <td>${b.checkoutDate}</td>
                                <td>${b.estimateDays}</td>
                                <td>${b.doctorFee}</td>
                                <td>${b.packagePrice}</td>
                                <td>${b.totalPrice}</td>
                            </tr>
                        `;
                            });

                            $("#bookingTableBody").html(rows);
                        } else {
                            $("#bookingTableBody").html(`<tr><td colspan="10" class="text-center">No bookings found</td></tr>`);
                        }
                    },
                    error: function (xhr) {
                        console.error("Error loading bookings:", xhr);
                        $("#bookingTableBody").html(`<tr><td colspan="10" class="text-center text-danger">Failed to load bookings</td></tr>`);
                    }
                });
            }

            // Search Functionality
            $("#searchBooking").on("keyup", function () {
                let value = $(this).val().toLowerCase();
                $("#bookingTableBody tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            // Initial Load
            loadBookings();
        });

    </script>

    <!-- Doctor Management Section -->
    <div id="doctors" class="hidden">
        <h1>Doctor Management</h1>

        <!-- Search & Add doctor Section -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDoctorModal">Add Doctor</button>
            <input type="text" id="searchDoctor" class="form-control w-25" placeholder="Search Doctors by Name or Email">
        </div>

        <!-- Doctor Table -->
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>Full Name</th>
                <th>Email</th>
                <th>Image</th>
                <th>Description</th>
                <th>Payment per Day</th>
                <th>Linkedin</th>
                <th>Booked</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="doctorTableBody"></tbody>
        </table>
    </div>

    <!-- Add Doctor Modal -->
    <div class="modal fade" id="addDoctorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Doctor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addDoctorForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="doctorName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="doctorEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="doctorDescription" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Payment per Day</label>
                            <input type="number" class="form-control" id="doctorPayment" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">LinkedIn URL</label>
                            <input type="url" class="form-control" id="doctorLinkedIn">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload Image</label>
                            <input type="file" class="form-control" id="doctorImage" accept="image/*" required>
                            <img id="addImagePreview" class="mt-2" style="width: 80px; height: 80px; display: none; border-radius: 5px;">
                        </div>
                        <button type="submit" class="btn btn-success">Save Doctor</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Doctor Modal -->
    <div class="modal fade" id="editDoctorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Doctor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editDoctorForm" enctype="multipart/form-data">
                        <input type="hidden" id="editDoctorEmail" name="email">

                        <div class="mb-3">
                            <label>Full Name</label>
                            <input type="text" id="editDoctorName" name="editDoctorName" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label>Description</label>
                            <textarea id="editDoctorDescription" name="editDoctorDescription" class="form-control"></textarea>
                        </div>
                        <div class="mb-3">
                            <label>Payment Per Day</label>
                            <input type="text" id="editDoctorPayment" name="editDoctorPayment" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label>LinkedIn</label>
                            <input type="text" id="editDoctorLinkedIn" name="editDoctorLinkedIn" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label>Profile Image</label>
                            <input type="file" id="editDoctorImage" name="editDoctorImage" class="form-control">
                            <img id="editImagePreview" class="img-fluid mt-2" style="width:70px; height:70px; display:none;">
                        </div>
                        <button type="submit" class="btn btn-primary">Update Doctor</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="packages" class="hidden">
        <h1>Package Management</h1>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPackageModal">Add Package</button>

        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Estimated Days</th>
                <th>Price (LKR)</th>
                <th>Activities</th>
                <th>Package Image</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="packageTableBody"></tbody>
        </table>
    </div>

    <!-- Add Package Modal -->
    <div class="modal fade" id="addPackageModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="addPackageForm" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Package</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Package Name</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Price (LKR)</label>
                            <input type="number" class="form-control" name="price" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Estimated Days</label>
                            <input type="number" class="form-control" name="estimateDays" min="1" max="20" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select Activities</label>
                            <select multiple class="form-control" name="activity" id="packageActivities" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload Package Image</label>
                            <input type="file" class="form-control" name="imageUrl" id="packageImage" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <img id="PackageImgPreview" style="width:80px;height:80px;display:none;border-radius:5px;">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Create Package</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Package Modal -->
    <div class="modal fade" id="editPackageModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="editPackageForm" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Package</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="editPackageId" name="id">
                        <div class="mb-3">
                            <label class="form-label">Package Name</label>
                            <input type="text" class="form-control" id="editPackageName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Price (LKR)</label>
                            <input type="number" class="form-control" id="editPackagePrice" name="price" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Estimated Days</label>
                            <input type="number" class="form-control" id="editPackageDays" name="estimateDays" min="1" max="20" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select Activities</label>
                            <select multiple class="form-control" name="activity" id="editPackageActivities" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload Package Image</label>
                            <input type="file" class="form-control" name="imageUrl" id="editPackageImage" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <img id="editPackageImgPreview" style="width:100px;height:100px;display:none;border-radius:5px;">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div id="payments" class="hidden">
        <h1>Payment Management</h1>

        <input type="text" id="searchEmail" class="form-control mb-3" placeholder="Search by user email...">

        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>User Email</th>
                <th>Amount</th>
                <th>Date</th>
            </tr>
            </thead>
            <tbody id="paymentTableBody"></tbody>
        </table>

        <script>
            let allPayments = []; // Store all payments globally

            function loadAllPayments() {
                $.ajax({
                    url: "http://localhost:8080/api/v1/payment/getAll",
                    type: "GET",
                    success: function (response) {
                        allPayments = response.data; // Save for filtering
                        renderPayments(allPayments); // Initial render
                    },
                    error: function () {
                        alert("Failed to load payments.");
                    }
                });
            }

            function renderPayments(payments) {
                const tbody = $("#paymentTableBody");
                tbody.empty();

                payments.forEach(payment => {
                    const row = `
            <tr>
                <td>${payment.id}</td>
                <td>${payment.userEmail}</td>
                <td>LKR ${payment.amount.toFixed(2)}</td>
                <td>${payment.paymentDate}</td>
            </tr>
        `;
                    tbody.append(row);
                });
            }

            // Live filter
            $("#searchEmail").on("input", function () {
                const query = $(this).val().toLowerCase();
                const filtered = allPayments.filter(p => p.userEmail.toLowerCase().includes(query));
                renderPayments(filtered);
            });

            // Load on page ready
            $(document).ready(function () {
                loadAllPayments();
            });

        </script>
    </div>

<!--    /////////////////////////////////-->

    <div id="articles" class="hidden">
        <h1>Article Management</h1>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addArticleModal">Add Article</button>
            <input type="text" id="searchArticle" class="form-control w-25" placeholder="Search by Title or Description">
        </div>
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Description</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="articleTableBody">
            <tr><td colspan="5" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- Add Article Modal -->
    <div class="modal fade" id="addArticleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Article</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addArticleForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="articleTitle" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="articleDescription" name="description" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload Image</label>
                            <input type="file" class="form-control" id="articleImage" name="imageUrl" accept="image/*">
                            <img id="addArticleImgPreview" class="mt-2" style="width: 80px; height: 80px; display: none; border-radius: 5px;">
                        </div>
                        <button type="submit" class="btn btn-success">Save Article</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Article Modal -->
    <div class="modal fade" id="editArticleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Article</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editArticleForm" enctype="multipart/form-data">
                        <input type="hidden" id="editArticleId" name="id">
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="editArticleTitle" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="editArticleDescription" name="description" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload Image</label>
                            <input type="file" class="form-control" id="editArticleImage" name="imageUrl" accept="image/*">
                            <img id="editArticleImgPreview" class="mt-2" style="width: 80px; height: 80px; display: none; border-radius: 5px;">
                        </div>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--    <script>-->
<!--        const ARTICLE_API = "http://localhost:8080/api/v1/article";-->

<!--        // Escape string for JS function call-->
<!--        function escapeQuotes(str) {-->
<!--            return str.replace(/'/g, "\\'").replace(/"/g, "&quot;");-->
<!--        }-->

<!--        // Load Articles-->
<!--        function loadArticles() {-->
<!--            fetch(`${ARTICLE_API}/getAll`)-->
<!--                .then(res => res.json())-->
<!--                .then(data => {-->
<!--                    const tbody = document.getElementById("articleTableBody");-->
<!--                    tbody.innerHTML = "";-->
<!--                    if (!data.data || data.data.length === 0) {-->
<!--                        tbody.innerHTML = `<tr><td colspan="5" class="text-center">No Articles Found</td></tr>`;-->
<!--                        return;-->
<!--                    }-->
<!--                    data.data.forEach(article => {-->
<!--                        const row = document.createElement("tr");-->
<!--                        row.innerHTML = `-->
<!--                    <td>${article.id}</td>-->
<!--                    <td>${article.title}</td>-->
<!--                    <td>${article.description}</td>-->
<!--                    <td>${article.imageUrl-->
<!--                            ? `<img src="http://localhost:8080/uploads/${article.imageUrl}" alt="img" style="width:60px;height:60px;border-radius:5px;">`-->
<!--                            : "No Image"}</td>-->
<!--                    <td>-->
<!--                        <button class="btn btn-sm btn-warning" onclick="editArticle(${article.id}, '${escapeQuotes(article.title)}', '${escapeQuotes(article.description)}', '${article.imageUrl || ''}')">Edit</button>-->
<!--                        <button class="btn btn-sm btn-danger" onclick="deleteArticle(${article.id})">Delete</button>-->
<!--                    </td>-->
<!--                `;-->
<!--                        tbody.appendChild(row);-->
<!--                    });-->
<!--                })-->
<!--                .catch(err => {-->
<!--                    console.error(err);-->
<!--                    document.getElementById("articleTableBody").innerHTML =-->
<!--                        `<tr><td colspan="5" class="text-center text-danger">Error Loading Articles</td></tr>`;-->
<!--                });-->
<!--        }-->

<!--        // Add Article-->
<!--        document.getElementById("addArticleForm").addEventListener("submit", e => {-->
<!--            e.preventDefault();-->
<!--            const formData = new FormData();-->
<!--            formData.append("title", document.getElementById("articleTitle").value);-->
<!--            formData.append("description", document.getElementById("articleDescription").value);-->
<!--            const file = document.getElementById("articleImage").files[0];-->
<!--            if (file) formData.append("imageUrl", file);-->

<!--            fetch(`${ARTICLE_API}/save`, { method: "POST", body: formData })-->
<!--                .then(res => res.json())-->
<!--                .then(data => {-->
<!--                    alert(data.message);-->
<!--                    if (data.code === 201 || data.code === 200) {-->
<!--                        document.getElementById("addArticleForm").reset();-->
<!--                        document.getElementById("addArticleImgPreview").style.display = "none";-->
<!--                        loadArticles();-->
<!--                        bootstrap.Modal.getInstance(document.getElementById("addArticleModal")).hide();-->
<!--                    }-->
<!--                })-->
<!--                .catch(console.error);-->
<!--        });-->

<!--        // Preview Image-->
<!--        document.getElementById("articleImage").addEventListener("change", e => {-->
<!--            const file = e.target.files[0];-->
<!--            if (file) {-->
<!--                const reader = new FileReader();-->
<!--                reader.onload = e => {-->
<!--                    const img = document.getElementById("addArticleImgPreview");-->
<!--                    img.src = e.target.result;-->
<!--                    img.style.display = "block";-->
<!--                };-->
<!--                reader.readAsDataURL(file);-->
<!--            }-->
<!--        });-->

<!--        // Edit Article-->
<!--        function editArticle(id, title, description, imageUrl) {-->
<!--            document.getElementById("editArticleId").value = id;-->
<!--            document.getElementById("editArticleTitle").value = title;-->
<!--            document.getElementById("editArticleDescription").value = description;-->
<!--            const imgPreview = document.getElementById("editArticleImgPreview");-->
<!--            if (imageUrl) {-->
<!--                imgPreview.src = `http://localhost:8080/uploads/${imageUrl}`;-->
<!--                imgPreview.style.display = "block";-->
<!--            } else imgPreview.style.display = "none";-->

<!--            new bootstrap.Modal(document.getElementById("editArticleModal")).show();-->
<!--        }-->

<!--        // Update Article-->
<!--        document.getElementById("editArticleForm").addEventListener("submit", e => {-->
<!--            e.preventDefault();-->
<!--            const id = document.getElementById("editArticleId").value;-->
<!--            const formData = new FormData();-->
<!--            formData.append("title", document.getElementById("editArticleTitle").value);-->
<!--            formData.append("description", document.getElementById("editArticleDescription").value);-->
<!--            const file = document.getElementById("editArticleImage").files[0];-->
<!--            if (file) formData.append("imageUrl", file);-->

<!--            fetch(`${ARTICLE_API}/update/${id}`, { method: "POST", body: formData })-->
<!--                .then(res => res.json())-->
<!--                .then(data => {-->
<!--                    alert(data.message);-->
<!--                    if (data.code === 201 || data.code === 200) {-->
<!--                        document.getElementById("editArticleForm").reset();-->
<!--                        document.getElementById("editArticleImgPreview").style.display = "none";-->
<!--                        loadArticles();-->
<!--                        bootstrap.Modal.getInstance(document.getElementById("editArticleModal")).hide();-->
<!--                    }-->
<!--                })-->
<!--                .catch(console.error);-->
<!--        });-->

<!--        // Delete Article-->
<!--        function deleteArticle(id) {-->
<!--            if (!confirm("Are you sure?")) return;-->
<!--            fetch(`${ARTICLE_API}/delete/${id}`, { method: "DELETE" })-->
<!--                .then(res => res.json())-->
<!--                .then(data => {-->
<!--                    alert(data.message);-->
<!--                    if (data.code === 201 || data.code === 200) loadArticles();-->
<!--                })-->
<!--                .catch(console.error);-->
<!--        }-->

<!--        // Search-->
<!--        document.getElementById("searchArticle").addEventListener("keyup", function() {-->
<!--            const filter = this.value.toLowerCase();-->
<!--            document.querySelectorAll("#articleTableBody tr").forEach(row => {-->
<!--                const title = row.cells[1]?.innerText.toLowerCase();-->
<!--                const desc = row.cells[2]?.innerText.toLowerCase();-->
<!--                row.style.display = title.includes(filter) || desc.includes(filter) ? "" : "none";-->
<!--            });-->
<!--        });-->

<!--        // Initial Load-->
<!--        document.addEventListener("DOMContentLoaded", loadArticles);-->
<!--    </script>-->




<!--////////////////////////////////////////////-->
    <div id="accommodations" class="hidden">
        <h1>Accommodation Management</h1>

        <!-- Add Accommodation Button -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAccommodationModal">
            Add Accommodation
        </button>

        <!-- Accommodation Table -->
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Location</th>
                <th>Category</th>
                <th>Cost Per Day (Rs.)</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="accommodationTableBody"></tbody>
        </table>
    </div>

    <!-- Add Accommodation Modal -->
    <div class="modal fade" id="addAccommodationModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-dialog">
            <form id="addAccommodationForm" method="POST" enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add Accommodation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" id="accommodationName" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea id="accommodationDescription" name="description" class="form-control" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Location</label>
                        <input type="text" id="accommodationLocation" name="location" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select id="accommodationCategory" name="category" class="form-control" required>
                            <option value="A/C">A/C</option>
                            <option value="Non A/C">Non A/C</option>
                            <option value="Luxary">Luxary</option>
                            <option value="City">City</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Cost Per Day</label>
                        <input type="text" id="accommodationCost" name="costPerDay" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Upload Image</label>
                        <input type="file" id="accommodationImage" name="imageUrl" class="form-control" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <img id="addImgPreview" src="#" style="width: 80px; height: 80px; display: none; border-radius: 5px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Accommodation</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Accommodation Modal -->
    <div class="modal fade" id="editAccommodationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form id="editAccommodationForm" method="POST" enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Accommodation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editAccommodationId">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" id="editAccommodationName" name="editAccommodationName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea id="editAccommodationDescription" name="editAccommodationDescription" class="form-control"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Location</label>
                        <input type="text" id="editAccommodationLocation" name="editAccommodationLocation" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select id="editAccommodationCategory" name="editAccommodationCategory" class="form-control">
                            <option value="A/C">A/C</option>
                            <option value="Non A/C">Non A/C</option>
                            <option value="Luxary">Luxary</option>
                            <option value="City">City</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Cost Per Day</label>
                        <input type="text" id="editAccommodationCostPerDay" name="editAccommodationCostPerDay" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Upload Image</label>
                        <input type="file" id="editAccommodationImage" name="editAccommodationImage" class="form-control" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <img id="editImgPreview" src="#" style="width:100px; height:100px; display:none; border-radius:5px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Activity Management -->
    <div id="activities" class="hidden">
        <h1>Activity Management</h1>

        <!-- Add Activity Button -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addActivityModal">
            Add Activity
        </button>

        <!-- Activity Table -->
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Cost Per Day (Rs.)</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="activityTableBody"></tbody>
        </table>
    </div>

    <!-- Add Activity Modal -->
    <div class="modal fade" id="addActivityModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form id="addActivityForm" method="POST" enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" id="activityName" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea id="activityDescription" name="description" class="form-control" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Cost Per Day</label>
                        <input type="text" id="activityCost" name="costPerDay" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Upload Image</label>
                        <input type="file" id="activityImage" name="imageUrl" class="form-control" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <img id="addActivityImgPreview" src="#" style="width: 80px; height: 80px; display: none; border-radius: 5px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Activity</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Activity Modal -->
    <div class="modal fade" id="editActivityModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form id="editActivityForm" method="POST" enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editActivityId">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" id="editActivityName" name="name" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea id="editActivityDescription" name="description" class="form-control"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Cost Per Day</label>
                        <input type="text" id="editActivityCost" name="costPerDay" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Upload Image</label>
                        <input type="file" id="editActivityImage" name="imageUrl" class="form-control" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <img id="editActivityImgPreview" src="#" style="width:100px; height:100px; display:none; border-radius:5px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

</div>
    <script>
    function showPanel(panelId) {
        $('.content > div').addClass('hidden');
        $('#' + panelId).removeClass('hidden');

        // Load data dynamically when a panel is clicked
        switch (panelId) {
            case 'users': /*fetchUsers();*/ break;
            case 'vehicles': /*fetchVehicles()*/; break;
            case 'bookings': ; break;
            case 'packages': ; break;
            case 'payments': ; break;
            case 'destinations': ; break;
            case 'guides': ; break;
            case 'settings': ; break;
            // Add more cases if needed
        }
    }

    $('#addUserForm').submit(function(event) {
        event.preventDefault();
        let name = $('#userName').val();
        let email = $('#userEmail').val();

        $.ajax({
            url: '/api/users',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ name, email }),
            success: function() {
                $('#addUserModal').modal('hide');
                fetchUsers();
                $('#addUserForm')[0].reset();
            }
        });
    });

    $(document).ready(function() {
        showPanel('dashboard'); // Show dashboard by default
    });
</script>
<script>
    function logout() {
        localStorage.removeItem("name");
        localStorage.removeItem("token");
        localStorage.removeItem("email");
        localStorage.removeItem("role");

        // Optional: hide/show UI parts if needed
        const userDropdown = document.getElementById("userDropdown");
        const signInUpLink = document.getElementById("signInUpLink");

        if (userDropdown) userDropdown.classList.add("d-none");
        if (signInUpLink) signInUpLink.classList.remove("d-none");

        // Redirect to home page
        window.location.href = "index.html";
    }
</script>

<!--<script src="AdminScripts/admin-vehicle.js"></script>-->
<script src="js/doctor.js"></script>
<script src="js/accommodation.js"></script>
<script src="js/activity.js"></script>
<script src="js/tpackage.js"></script>
<script src="js/article.js"></script>
<!--<script src="AdminScripts/admin-destination.js"></script>-->
<!--<script src="AdminScripts/admin-package.js"></script>-->
<!--<script src="AdminScripts/admin-bookings.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
